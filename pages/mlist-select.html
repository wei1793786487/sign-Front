<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>会议签到系统</title>
    <link rel="stylesheet" href="../lib/layui-v2.5.4/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
</head>

<body>
    <div class="layuimini-container">
        <div class="layuimini-main">


            <blockquote class="layui-elem-quote">
                
                请按照模板文件填写,系统将自动识别，并将报名人员与人员库人员自动关联。
                <a href="../xls/mode.xlsx" class="layui-btn layui-btn-primary">点我下载模板文件</a><br>
            </br>
            其中模板文件中的联系方式为选填，如果用户本身没有存在电话信息，那么系统会自动读取会议添加模板<br>
            并自动添加人员的联系方式储存到系统中。

            </blockquote>


            <div class="layui-form-item">
                <label class="layui-form-label">请选择</label>
                <div class="layui-input-inline">
                    <input type="text" name="mid" style="display: none;" id="mid">
                    <input type="text" name="" placeholder="会议" autocomplete="off" class="layui-input" id="demo2">
                    <input type="text" name="pid" style="display: none;" id="pid">
                    <input type="text" name="" placeholder="人员姓名" autocomplete="off" class="layui-input" id="demo3" style="margin-top: 20px;">
                    <button type="button" class="layui-btn layui-btn-normal" style="margin-top: 20px;">确认选择</button>
                </div>

                <!-- <button type="button" class="layui-btn layui-btn-primary" id="test4"><i
                        class="layui-icon"></i>点我上传人员列表</button> -->

            </div>


        </div>
    </div>

    <script type="text/html" id="xuhao">
        {{d.LAY_TABLE_INDEX+1}}
    </script>
    <script src="../lib/layui-v2.5.4/layui.js" charset="utf-8"></script>
    <script src="../js/lay-config.js?v=1.0.4" charset="utf-8"></script>
    <script src="../lib/jquery-3.4.1/jquery-3.4.1.min.js"></script>
    <script>
        layui.use(['table', 'form', 'tableSelect', 'upload'], function () {
            var $ = layui.jquery,
                table = layui.table,
                form = layui.form,
                tableSelect = layui.tableSelect,
                upload = layui.upload;


            tableSelect.render({
                elem: '#demo2',
                checkedKey: 'ID',
                searchKey: 'meetingName',
                searchPlaceholder: '会议搜索',
                
                table: {
                    url: 'http://api.wukaka.com/meeting',
                    cols: [
                        [{
                                type: 'radio'
                            },
                            {
                                width: 100,
                                title: 'ID',
                                sort: true,
                                templet: "#xuhao",
                                align: "center"
                            },
                            {
                                field: 'meetingName',
                                width: 200,
                                title: '会议名字',
                                align: "center"
                            },
                            {
                                field: 'mettingAddress',
                                width: 200,
                                title: '会议地点',
                                align: "center"
                            },
                        ]
                    ]
                },
                done: function (elem, data) {
                    var NEWJSON = []
                    layui.each(data.data, function (index, item) {
                        NEWJSON.push(item.meetingName)
                    })
                    elem.val(NEWJSON.join(","))
                    //将选择的id放入mid里面
                    $("#mid").val = data["id"];
                }
            })

            tableSelect.render({
                elem: '#demo3',
                searchKey: 'personName',
                checkedKey: 'id',
                searchPlaceholder: '人员名称',
                height:'400',  //自定义高度
                width:'500',  //自定义宽度
                table: {
                    url: 'http://api.wukaka.com/person',
                    cols: [
                        [{
                                type: 'checkbox'
                            },
                            {
                                width: 100,
                                title: 'ID',
                                sort: true,
                                templet: "#xuhao",
                                align: "center"
                            },
                            {
                            field: 'personName',
                            title: '人员姓名',
                        }
                           
                        ]
                    ]
                },
                done: function (elem, data) {
                    var psesons = []
                    layui.each(data.data, function (index, item) {
                        psesons.push(item.personName)
                    })
                    
                    $("#pid").val = psesons;
                }
            })











            upload.render({ //允许上传的文件后缀
                elem: '#test4',
                url: '/upload/',
                accept: 'file',
                exts: 'xlsx|xls',
                done: function (res) {
                    console.log(res)
                },
                before: function (obj) {
                    //判断是不选择了要上传的会议
                    var ischosemeet = $("#mid").val;
                    if (val === "") {
                        layer.alert('请先选择会议', {
                            icon: 2
                        });
                    } else {
                        layer.load(); //上传loading
                    }
                },
                data: {
                    mid: $("#mid").val
                }

            });

        });
    </script>
</body>

</html>